# --------------------------------------------------------------------
#  Plan Mensual de Comidas – Resumen técnico
#  Estado de la versión 1.4.7  (cerrada el 27-abr-2025 17:15 ART)
# --------------------------------------------------------------------

Estructura de carpetas
──────────────────────
plan_mensual_comidas/
├─ core/                    ← lógica de negocio
│  ├─ __init__.py
│  ├─ extraer_txt.py
│  ├─ extraer_pdf.py
│  ├─ extraer_ocr.py
│  ├─ normalizador_recetas.py
│  ├─ procesar_recetas.py
│  ├─ logger.py             ← refactor v1.4.7
│  └─ gestor.py             ← aún v1.2 (contiene demo)
├─ tests/                   ← ejecución local, sin Notion
│  ├─ test_extraer_txt.py
│  ├─ test_extraer_pdf.py
│  └─ test_procesar_recetas.py
├─ recetas/
│  ├─ sin_procesar/         ← archivos de entrada (.txt/.pdf/.jpg)
│  └─ procesadas/
│     ├─ Receta Original/
│     └─ Recetas JSON/
├─ .log/
│  └─ 1.4.7/                ← 1 archivo por módulo con timestamp
├─ VERSION.txt              ← “1.4.7”
└─ requirements.txt         ← pdfplumber, pytesseract, python-dotenv, notion-client …

Logger (v1.4.7)
───────────────
✓ Un único root-logger.
✓ Console-handler sin duplicados.
✓ File-handler en “.log/1.4.7/log-…-<módulo>.txt”.
✓ Encabezado con versión SOLO en archivo.
✓ Warnings de pdfminer silenciados.

Extracción de texto
───────────────────
• extraer_txt.py        – OK (utf-8)
• extraer_pdf.py        – OK (pdfplumber; warnings silenciados)
• extraer_ocr.py        – OK (pdf → images → pytesseract)

Normalizador
────────────
• Detecta URL → campo “origen” (o “Desconocido”).
• Limpia títulos “cómo hacerlo… paso a paso”.
• Ingredientes simples             – funciona.
• Porciones / fracciones           – **pendiente** (para 1.4.8).
• Tags básicos (“proteico”, “simple”).

Procesador de recetas
─────────────────────
1. Detecta tipo de archivo → llama extractor.
2. Normaliza → mueve original → guarda JSON.
3. Rollback si falla guardado JSON.
4. Devuelve True/False por archivo procesado.
5. Resumen final (✅/❌) en consola y log.

Tests locales
─────────────
• test_extraer_txt.py   – lee cualquier .txt en *sin_procesar*.
• test_extraer_pdf.py   – idem para .pdf.
• test_procesar_recetas – procesa lote completo y muestra resumen.

Gestor Notion
─────────────
Estado: v1.2 demo con receta hard-codeada.
Falta: integrar logger y llamadas reales a Notion.

Pendiente para v1.4.8
─────────────────────
1. **Refactor gestor.py**  
   – Eliminar bloque demo.  
   – Usar wrappers de logger.  
   – Preparar tests test_gestor.py (sin acceder a Notion).

2. **Parseo avanzado de ingredientes**  
   – Unidades compuestas (g, ml, “1 ½ taza”).  
   – Detección de número de porciones (“para 9 panes”).

3. **Documentación / README**  
   – Pasos para crear venv, instalar reqs y ejecutar tests.

4. **Mejora de tests**  
   – PyTest + fixtures para varios ejemplos (txt & pdf).

# --------------------------------------------------------------------
# Fin de resumen – listo para archivar como 1.4.7 y abrir rama 1.4.8
# --------------------------------------------------------------------

