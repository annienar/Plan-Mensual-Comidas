{
  "contextual_analysis": {
    "required_before_decisions": {
      "analyze_codebase_structure": true,
      "review_project_roadmap": true,
      "understand_current_architecture": true,
      "check_existing_patterns": true,
      "validate_assumptions": true
    },
    "analysis_checklist": {
      "codebase_review": [
        "examine_directory_structure",
        "identify_existing_patterns",
        "review_current_implementation",
        "check_coding_standards_in_use",
        "analyze_test_coverage_approach"
      ],
      "roadmap_alignment": [
        "review_project_goals",
        "check_planned_features",
        "identify_technical_priorities",
        "understand_timeline_constraints",
        "validate_scope_appropriateness"
      ],
      "architecture_context": [
        "understand_current_tech_stack",
        "identify_integration_points",
        "review_data_flow",
        "check_performance_requirements",
        "analyze_scalability_needs"
      ],
      "domain_specific": [
        "review_spanish_field_naming_pattern",
        "check_current_llm_models_in_use",
        "understand_recipe_processing_pipeline", 
        "analyze_pantry_integration_roadmap",
        "check_notion_integration_patterns",
        "validate_commercial_licensing_requirements"
      ]
    },
    "decision_validation": {
      "fits_current_architecture": true,
      "aligns_with_roadmap": true,
      "matches_existing_patterns": true,
      "appropriate_for_project_scale": true,
      "considers_technical_debt": true
    },
    "before_recommendations": {
      "search_codebase_for_existing_solutions": true,
      "check_current_implementation_patterns": true,
      "review_recent_changes_and_decisions": true,
      "understand_team_preferences": true,
      "consider_maintenance_burden": true
    },
    "tools_to_use": [
      "codebase_search",
      "file_search", 
      "grep_search",
      "read_file",
      "list_dir"
    ],
    "mandatory_steps": {
      "before_suggesting_new_tools": "Check what tools are already in use (scripts/, existing automation)",
      "before_architectural_changes": "Understand current clean architecture (domain/application/infrastructure)",
      "before_process_changes": "Review existing workflows (archive-first, Spanish-first, test-driven)",
      "before_rule_changes": "Analyze current rule effectiveness and existing patterns",
      "before_documentation_changes": "Review existing documentation automation and structure",
      "before_spanish_changes": "Check existing Spanish field naming and terminology",
      "before_llm_changes": "Review current Phi/LLaVA-Phi3 setup and commercial licensing",
      "before_recipe_changes": "Understand current processing pipeline (sin_procesar -> json)"
    }
  }
} 